<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BundleBot — Build My Bundle</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 24px; }
    .wrap { max-width: 760px; margin: 0 auto; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; background: #fff; }
    label { display:block; margin:12px 0 6px; }
    textarea,input,button { width:100%; padding:12px; border-radius:10px; border:1px solid #ccc; }
    button { background:#111; color:#fff; font-weight:700; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .hint { color:#666; font-size:.9rem; margin-top:6px; }
    .status { margin-top:12px; color:#333; min-height: 1.2em; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>BundleBot</h1>
    <p>Tell us what you need (budget, who it’s for, any must-haves). We’ll build a money-saving bundle.</p>

    <div class="card">
      <form id="bundle-form">
        <label for="prompt">What should we build?</label>
        <textarea id="prompt" name="prompt" rows="5"
          placeholder="e.g., Build me a dorm room setup for a University of Connecticut freshman under $500."
          required></textarea>
        <div class="hint">Tip: include budget, audience, and must-haves.</div>

        <button type="submit" id="submit-btn">Get My Bundle</button>
        <div id="status" class="status"></div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById('bundle-form');
    const btn = document.getElementById('submit-btn');
    const statusEl = document.getElementById('status');
    const promptEl = document.getElementById('prompt');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const prompt = promptEl.value.trim();
      if (!prompt) {
        statusEl.textContent = 'Please enter a request.';
        promptEl.focus();
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Building your bundle…';
      statusEl.textContent = '';

      try {
        const resp = await fetch('/api/build-bundle', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt })
        });

        const data = await resp.json().catch(() => ({}));
        if (!resp.ok || !data || !Array.isArray(data.items)) {
          throw new Error(data?.error || 'Unexpected response from server.');
        }

        // Save for results page and navigate
        sessionStorage.setItem('bundle_data', JSON.stringify(data));
        window.location.href = '/results.html';
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Sorry—something went wrong. Please try again.';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Get My Bundle';
      }
    });
  </script>
</body>
</html>
